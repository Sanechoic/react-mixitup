{"remainingRequest":"/Users/richie/projects/react-mixitup/node_modules/thread-loader/dist/cjs.js??ref--11-1!/Users/richie/projects/react-mixitup/node_modules/babel-loader/lib/index.js??ref--11-2!/Users/richie/projects/react-mixitup/node_modules/source-map-loader/index.js!/Users/richie/projects/react-mixitup/src/react-mixitup.tsx","dependencies":[{"path":"/Users/richie/projects/react-mixitup/src/react-mixitup.tsx","mtime":1555010315734},{"path":"/Users/richie/projects/react-mixitup/node_modules/cache-loader/dist/cjs.js","mtime":1555000957022},{"path":"/Users/richie/projects/react-mixitup/node_modules/thread-loader/dist/cjs.js","mtime":1555000957340},{"path":"/Users/richie/projects/react-mixitup/node_modules/babel-loader/lib/index.js","mtime":1548679235691},{"path":"/Users/richie/projects/react-mixitup/node_modules/source-map-loader/index.js","mtime":1548929420374}],"contextDependencies":[],"result":["import _toConsumableArray from \"/Users/richie/projects/react-mixitup/node_modules/docz-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"/Users/richie/projects/react-mixitup/node_modules/docz-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectSpread from \"/Users/richie/projects/react-mixitup/node_modules/docz-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nvar _jsxFileName = \"/Users/richie/projects/react-mixitup/src/react-mixitup.tsx\";\n\n(function () {\n  var enterModule = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).enterModule;\n  enterModule && enterModule(module);\n})();\n\n/**\n * @class ReactMixitup\n */\nimport uniq from 'lodash.uniq';\nimport * as React from 'react';\nvar OuterBound = React.memo(React.forwardRef(function (props, ref) {\n  return React.createElement(\"div\", Object.assign({\n    style: {\n      position: 'relative'\n    }\n  }, props, {\n    ref: ref,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 60\n    },\n    __self: this\n  }));\n}));\n\nfunction init() {\n  return {\n    animate: false,\n    commit: false,\n    firstRender: true,\n    hash: null,\n    mount: false\n  };\n}\n\nvar getItemsHash = function getItemsHash(items) {\n  return items.join(',');\n};\n\nfunction reducer(state, action) {\n  switch (action.type) {\n    case 'SET_HASH':\n      if (typeof action.hash === 'undefined') {\n        throw new Error();\n      }\n\n      var mount = true;\n\n      if (state.firstRender || state.animate || state.mount || state.commit || !action.transition) {\n        mount = false;\n      }\n\n      return _objectSpread({}, state, {\n        hash: action.hash,\n        firstRender: false,\n        mount: mount\n      });\n\n    case 'COMMIT':\n      return _objectSpread({}, state, {\n        commit: true,\n        mount: false\n      });\n\n    case 'ANIMATE':\n      return _objectSpread({}, state, {\n        animate: true,\n        commit: false\n      });\n\n    case 'STOP_ANIMATION':\n      return _objectSpread({}, state, {\n        animate: false,\n        mount: false\n      });\n\n    default:\n      throw new Error();\n  }\n}\n\nvar getConfig = function getConfig(_ref) {\n  var currentItems = _ref.currentItems,\n      nextItems = _ref.nextItems;\n  var addedItems = nextItems.filter(function (currentKey) {\n    return !currentItems.includes(currentKey);\n  });\n  var removedItems = currentItems.filter(function (previousKey) {\n    return !nextItems.includes(previousKey);\n  });\n  return {\n    addedItems: addedItems,\n    removedItems: removedItems\n  };\n};\n\nfunction onNextFrame(callback) {\n  setTimeout(function () {\n    window.requestAnimationFrame(callback);\n  }, 0);\n}\n\nvar makeAbsoluteWrapper = function makeAbsoluteWrapper(Wrapper) {\n  return React.memo(React.forwardRef(function (props, ref) {\n    return React.createElement(Wrapper, Object.assign({\n      style: {\n        position: 'absolute',\n        top: '0',\n        left: '0',\n        right: '0',\n        visibility: 'hidden',\n        zIndex: -1\n      }\n    }, props, {\n      ref: ref,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140\n      },\n      __self: this\n    }));\n  }));\n};\n\nvar makeWrapper = function makeWrapper(ReactMixitupWrapper) {\n  return React.memo(React.forwardRef(function (props, ref) {\n    return React.createElement(ReactMixitupWrapper, Object.assign({}, props, {\n      ref: ref,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157\n      },\n      __self: this\n    }));\n  }));\n};\n\nvar ReactMixitup = React.memo(React.forwardRef(function (_ref2, outerBoundRef) {\n  var unparsedItems = _ref2.items,\n      _ref2$duration = _ref2.duration,\n      duration = _ref2$duration === void 0 ? 500 : _ref2$duration,\n      renderCells = _ref2.renderCells,\n      _ref2$Wrapper = _ref2.Wrapper,\n      ReactMixitupWrapper = _ref2$Wrapper === void 0 ? 'div' : _ref2$Wrapper,\n      _ref2$transition = _ref2.transition,\n      transition = _ref2$transition === void 0 ? true : _ref2$transition;\n  var Wrapper = React.useMemo(function () {\n    return makeWrapper(ReactMixitupWrapper);\n  }, [ReactMixitupWrapper]);\n  var AbsoluteWrapper = React.useMemo(function () {\n    return makeAbsoluteWrapper(Wrapper);\n  }, [Wrapper]);\n  var items = unparsedItems.map(function (key) {\n    return key.toString();\n  });\n\n  var _React$useReducer = React.useReducer(reducer, items, init),\n      _React$useReducer2 = _slicedToArray(_React$useReducer, 2),\n      _React$useReducer2$ = _React$useReducer2[0],\n      hash = _React$useReducer2$.hash,\n      animate = _React$useReducer2$.animate,\n      mount = _React$useReducer2$.mount,\n      commit = _React$useReducer2$.commit,\n      unsafeDispatch = _React$useReducer2[1];\n\n  var unmounted = React.useRef(false);\n  React.useEffect(function () {\n    return function () {\n      unmounted.current = true;\n    };\n  }, []);\n  var dispatch = React.useCallback(function (action) {\n    if (unmounted.current) {\n      return;\n    }\n\n    unsafeDispatch(action);\n  }, []);\n  var refs = React.useRef({\n    containerHeight: {\n      current: null,\n      previous: null\n    },\n    previousPositions: {},\n    currentPositions: {},\n    currentItems: items,\n    previousItems: [],\n    config: {\n      addedItems: [],\n      removedItems: []\n    },\n    persistedElement: null\n  });\n  var newHash = getItemsHash(items);\n  var newGrid = newHash !== hash;\n  /* just to handle if clicking really fast, then ignore the update */\n\n  if (mount || commit) {\n    newGrid = false;\n    newHash = hash;\n  }\n\n  if (newGrid) {\n    refs.current.config = getConfig({\n      currentItems: refs.current.currentItems,\n      nextItems: items\n    });\n    /* START UPDATE */\n\n    if (!animate) {\n      refs.current.previousItems = refs.current.currentItems;\n    }\n\n    refs.current.currentItems = items;\n    /* END UPDATE */\n  }\n\n  var _refs$current = refs.current,\n      previousPositions = _refs$current.previousPositions,\n      currentPositions = _refs$current.currentPositions,\n      currentItems = _refs$current.currentItems,\n      previousItems = _refs$current.previousItems,\n      _refs$current$config = _refs$current.config,\n      addedItems = _refs$current$config.addedItems,\n      removedItems = _refs$current$config.removedItems;\n  React.useEffect(function () {\n    if (newGrid) {\n      dispatch({\n        type: 'SET_HASH',\n        hash: newHash,\n        transition: transition\n      });\n    }\n  }, [newHash, newGrid, transition]);\n  React.useEffect(function () {\n    if (mount) {\n      /* make sure the mount has been committed to the DOM, double make sure by wrapping in onNextFrame */\n      onNextFrame(function () {\n        dispatch({\n          type: 'COMMIT'\n        });\n      });\n    }\n  }, [mount]);\n  React.useEffect(function () {\n    if (commit) {\n      onNextFrame(function () {\n        dispatch({\n          type: 'ANIMATE'\n        });\n      });\n    }\n  }, [commit]);\n  React.useEffect(function () {\n    var timer;\n\n    var clear = function clear() {\n      window.clearTimeout(timer);\n    };\n\n    if (animate) {\n      timer = window.setTimeout(function () {\n        dispatch({\n          type: 'STOP_ANIMATION'\n        });\n      }, duration);\n    } else {\n      clear();\n    }\n\n    return clear;\n  }, [animate, newHash]);\n\n  if (commit) {\n    return refs.current.persistedElement;\n  }\n\n  var rows = function rows(_ref3) {\n    var itemsToRender = _ref3.itemsToRender,\n        ref = _ref3.ref,\n        style = _ref3.style;\n\n    var makeRef = function makeRef(key) {\n      if (typeof ref === 'undefined') {\n        return;\n      }\n\n      return function (el) {\n        if (el) {\n          ref(key, el);\n        }\n      };\n    };\n\n    var makeStyle = function makeStyle(key) {\n      return typeof style !== 'undefined' ? style(key) : undefined;\n    };\n\n    return renderCells(itemsToRender.map(function (key) {\n      return {\n        key: key,\n        ref: makeRef(key),\n        style: makeStyle(key)\n      };\n    }));\n  };\n\n  var wrapperMeasureContainerHeight = function wrapperMeasureContainerHeight(context) {\n    return function (el) {\n      if (!el) {\n        return;\n      }\n\n      refs.current.containerHeight[context] = el.offsetHeight;\n    };\n  };\n\n  var measureNewGrid = newGrid ? React.createElement(AbsoluteWrapper, {\n    ref: wrapperMeasureContainerHeight('current'),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 348\n    },\n    __self: this\n  }, rows({\n    itemsToRender: currentItems,\n    ref: function ref(key, el) {\n      currentPositions[key] = {\n        x: el.offsetLeft,\n        y: el.offsetTop\n      };\n    }\n  })) : null;\n\n  if (!transition) {\n    return React.createElement(OuterBound, {\n      ref: outerBoundRef,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 363\n      },\n      __self: this\n    }, React.createElement(Wrapper, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 364\n      },\n      __self: this\n    }, rows({\n      itemsToRender: currentItems\n    })));\n  }\n\n  var child = React.createElement(React.Fragment, null, React.createElement(Wrapper, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 375\n    },\n    __self: this\n  }, rows({\n    itemsToRender: currentItems\n  })), measureNewGrid);\n\n  if (newGrid) {\n    child = React.createElement(React.Fragment, null, React.createElement(Wrapper, {\n      ref: wrapperMeasureContainerHeight('previous'),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 387\n      },\n      __self: this\n    }, rows({\n      itemsToRender: previousItems,\n      ref: function ref(key, el) {\n        if (el) {\n          previousPositions[key] = {\n            x: el.offsetLeft,\n            y: el.offsetTop\n          };\n        }\n      }\n    })), measureNewGrid);\n  }\n\n  var animationRenderItems = uniq([].concat(_toConsumableArray(previousItems), _toConsumableArray(addedItems), _toConsumableArray(removedItems))).sort();\n\n  if (mount) {\n    child = React.createElement(React.Fragment, null, React.createElement(Wrapper, {\n      style: {\n        height: refs.current.containerHeight.previous + 'px'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 410\n      },\n      __self: this\n    }, rows({\n      itemsToRender: animationRenderItems,\n      style: function style(key) {\n        var added = addedItems.includes(key);\n        var removed = removedItems.includes(key);\n\n        var _ref4 = added ? currentPositions[key] : previousPositions[key],\n            x = _ref4.x,\n            y = _ref4.y;\n\n        var z = 1;\n\n        if (added) {\n          z = 0;\n        }\n\n        if (removed) {\n          z = 1;\n        }\n\n        var transform = \"translate3d(\".concat([x, y, 0].join('px,'), \"px) scale(\").concat(z, \")\");\n        var style = {\n          transform: transform,\n          position: 'absolute',\n          top: 0,\n          left: 0,\n          margin: 0\n        };\n        return style;\n      }\n    })));\n  }\n\n  if (animate) {\n    child = React.createElement(React.Fragment, null, React.createElement(Wrapper, {\n      style: {\n        height: refs.current.containerHeight.current + 'px'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 449\n      },\n      __self: this\n    }, rows({\n      itemsToRender: animationRenderItems,\n      style: function style(key) {\n        var added = addedItems.includes(key);\n        var removed = removedItems.includes(key);\n        /* currentPositions[key] can be undefined if new items are\n        added during animate and are yet to be measured */\n\n        var _ref5 = currentPositions[key] || {},\n            _ref5$x = _ref5.x,\n            x = _ref5$x === void 0 ? 0 : _ref5$x,\n            _ref5$y = _ref5.y,\n            y = _ref5$y === void 0 ? 0 : _ref5$y;\n\n        var z = 1;\n\n        if (added) {\n          z = 1;\n        }\n\n        if (removed) {\n          z = 0;\n        }\n\n        var transform = \"translate3d(\".concat([x, y, 0].join('px,'), \"px) scale(\").concat(z, \")\");\n        var style = {\n          transform: transform,\n          position: 'absolute',\n          top: 0,\n          left: 0,\n          margin: 0,\n          transition: \"transform \".concat(duration, \"ms ease\")\n        };\n        return style;\n      }\n    })), measureNewGrid);\n  }\n\n  refs.current.persistedElement = React.createElement(OuterBound, {\n    ref: outerBoundRef,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 488\n    },\n    __self: this\n  }, child);\n  return refs.current.persistedElement;\n}));\nvar _default = ReactMixitup;\nexport default _default;\n\nif (typeof ReactMixitup !== 'undefined' && ReactMixitup && ReactMixitup === Object(ReactMixitup)) {\n  Object.defineProperty(ReactMixitup, '__filemeta', {\n    enumerable: true,\n    configurable: true,\n    value: {\n      name: \"ReactMixitup\",\n      filename: \"src/react-mixitup.tsx\"\n    }\n  });\n}\n\n;\n\n(function () {\n  var reactHotLoader = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).default;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(OuterBound, \"OuterBound\", \"/Users/richie/projects/react-mixitup/src/react-mixitup.tsx\");\n  reactHotLoader.register(init, \"init\", \"/Users/richie/projects/react-mixitup/src/react-mixitup.tsx\");\n  reactHotLoader.register(getItemsHash, \"getItemsHash\", \"/Users/richie/projects/react-mixitup/src/react-mixitup.tsx\");\n  reactHotLoader.register(reducer, \"reducer\", \"/Users/richie/projects/react-mixitup/src/react-mixitup.tsx\");\n  reactHotLoader.register(getConfig, \"getConfig\", \"/Users/richie/projects/react-mixitup/src/react-mixitup.tsx\");\n  reactHotLoader.register(onNextFrame, \"onNextFrame\", \"/Users/richie/projects/react-mixitup/src/react-mixitup.tsx\");\n  reactHotLoader.register(makeAbsoluteWrapper, \"makeAbsoluteWrapper\", \"/Users/richie/projects/react-mixitup/src/react-mixitup.tsx\");\n  reactHotLoader.register(makeWrapper, \"makeWrapper\", \"/Users/richie/projects/react-mixitup/src/react-mixitup.tsx\");\n  reactHotLoader.register(ReactMixitup, \"ReactMixitup\", \"/Users/richie/projects/react-mixitup/src/react-mixitup.tsx\");\n  reactHotLoader.register(_default, \"default\", \"/Users/richie/projects/react-mixitup/src/react-mixitup.tsx\");\n})();\n\n;\n\n(function () {\n  var leaveModule = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).leaveModule;\n  leaveModule && leaveModule(module);\n})();",{"version":3,"sources":["/Users/richie/projects/react-mixitup/src/react-mixitup.tsx"],"names":["uniq","React","OuterBound","memo","forwardRef","props","ref","position","init","animate","commit","firstRender","hash","mount","getItemsHash","items","join","reducer","state","action","type","Error","transition","getConfig","currentItems","nextItems","addedItems","filter","currentKey","includes","removedItems","previousKey","onNextFrame","callback","setTimeout","window","requestAnimationFrame","makeAbsoluteWrapper","Wrapper","top","left","right","visibility","zIndex","makeWrapper","ReactMixitupWrapper","ReactMixitup","outerBoundRef","unparsedItems","duration","renderCells","useMemo","AbsoluteWrapper","map","key","toString","useReducer","unsafeDispatch","unmounted","useRef","useEffect","current","dispatch","useCallback","refs","containerHeight","previous","previousPositions","currentPositions","previousItems","config","persistedElement","newHash","newGrid","timer","clear","clearTimeout","rows","itemsToRender","style","makeRef","el","makeStyle","undefined","wrapperMeasureContainerHeight","context","offsetHeight","measureNewGrid","x","offsetLeft","y","offsetTop","child","animationRenderItems","sort","height","added","removed","z","transform","margin"],"mappings":"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","sourcesContent":["/**\n * @class ReactMixitup\n */\n\nimport uniq from 'lodash.uniq';\nimport * as React from 'react';\n\ninterface IPosition {\n  x: number;\n  y: number;\n  z?: number;\n}\ninterface IPositions {\n  [key: string]: IPosition;\n}\ninterface IState {\n  hash: null | string;\n  mount: boolean;\n  commit: boolean;\n  animate: boolean;\n  firstRender: boolean;\n}\n\ntype UnparsedItems = Array<string | number | boolean>;\ntype Item = string;\ntype Items = Item[];\n\ninterface IWrapperProps {\n  children: React.ReactNode;\n  style?: React.CSSProperties;\n  ref?: React.Ref<any>;\n}\n\ntype WrapperType = any;\n\ninterface IProps {\n  items: UnparsedItems;\n  duration?: number;\n  renderCells: (\n    items: Array<{\n      key: string;\n      ref?: React.Ref<any>;\n      style?: React.CSSProperties;\n    }>\n  ) => React.ReactNode;\n  Wrapper?: WrapperType;\n  transition?: boolean;\n}\n\ninterface IAction {\n  type: 'SET_HASH' | 'STOP_ANIMATION' | 'ANIMATE' | 'COMMIT';\n  hash?: string | null;\n  key?: string;\n  el?: HTMLElement | null;\n  transition?: boolean;\n}\n\nconst OuterBound = React.memo(\n  React.forwardRef((props: { children: React.ReactNode }, ref?: React.Ref<any>) => (\n    <div style={{ position: 'relative' }} {...props} ref={ref} />\n  ))\n);\n\nfunction init(): IState {\n  return {\n    animate: false,\n    commit: false,\n    firstRender: true,\n    hash: null,\n    mount: false\n  };\n}\n\nconst getItemsHash = (items: Items): string => {\n  return items.join(',');\n};\n\nfunction reducer(state: IState, action: IAction): IState {\n  switch (action.type) {\n    case 'SET_HASH':\n      if (typeof action.hash === 'undefined') {\n        throw new Error();\n      }\n      let mount = true;\n      if (state.firstRender || state.animate || state.mount || state.commit || !action.transition) {\n        mount = false;\n      }\n      return {\n        ...state,\n        hash: action.hash,\n        firstRender: false,\n        mount\n      };\n    case 'COMMIT':\n      return {\n        ...state,\n        commit: true,\n        mount: false\n      };\n    case 'ANIMATE':\n      return {\n        ...state,\n        animate: true,\n        commit: false\n      };\n    case 'STOP_ANIMATION':\n      return {\n        ...state,\n        animate: false,\n        mount: false\n      };\n    default:\n      throw new Error();\n  }\n}\n\nconst getConfig = ({ currentItems, nextItems }: { currentItems: Items; nextItems: Items }) => {\n  const addedItems = nextItems.filter(currentKey => {\n    return !currentItems.includes(currentKey);\n  });\n  const removedItems = currentItems.filter(previousKey => {\n    return !nextItems.includes(previousKey);\n  });\n\n  return {\n    addedItems,\n    removedItems\n  };\n};\n\nfunction onNextFrame(callback: () => any) {\n  setTimeout(() => {\n    window.requestAnimationFrame(callback);\n  }, 0);\n}\n\nconst makeAbsoluteWrapper = (Wrapper: React.JSXElementConstructor<any>) =>\n  React.memo(\n    React.forwardRef((props: { children: React.ReactNode }, ref?: React.Ref<any>) => (\n      <Wrapper\n        style={{\n          position: 'absolute',\n          top: '0',\n          left: '0',\n          right: '0',\n          visibility: 'hidden',\n          zIndex: -1\n        }}\n        {...props}\n        ref={ref}\n      />\n    ))\n  );\n\nconst makeWrapper = (ReactMixitupWrapper: WrapperType) => {\n  return React.memo(\n    React.forwardRef((props: IWrapperProps, ref) => <ReactMixitupWrapper {...props} ref={ref} />)\n  );\n};\n\nconst ReactMixitup = React.memo(\n  React.forwardRef(\n    (\n      {\n        items: unparsedItems,\n        duration = 500,\n        renderCells,\n        Wrapper: ReactMixitupWrapper = 'div',\n        transition = true\n      }: IProps,\n      outerBoundRef: React.Ref<HTMLDivElement>\n    ): JSX.Element | null => {\n      const Wrapper = React.useMemo(() => makeWrapper(ReactMixitupWrapper), [ReactMixitupWrapper]);\n      const AbsoluteWrapper = React.useMemo(() => makeAbsoluteWrapper(Wrapper), [Wrapper]);\n\n      const items: Items = unparsedItems.map(key => key.toString());\n      const [{ hash, animate, mount, commit }, unsafeDispatch] = React.useReducer(\n        reducer,\n        items,\n        init\n      );\n\n      const unmounted = React.useRef(false);\n      React.useEffect(\n        () => () => {\n          unmounted.current = true;\n        },\n        []\n      );\n\n      const dispatch = React.useCallback((action: IAction) => {\n        if (unmounted.current) {\n          return;\n        }\n        unsafeDispatch(action);\n      }, []);\n\n      const refs = React.useRef<{\n        containerHeight: {\n          current: number | null;\n          previous: number | null;\n        };\n        previousPositions: IPositions;\n        currentPositions: IPositions;\n        currentItems: Items;\n        previousItems: Items;\n        config: {\n          addedItems: Items;\n          removedItems: Items;\n        };\n        persistedElement: JSX.Element | null;\n      }>({\n        containerHeight: { current: null, previous: null },\n        previousPositions: {},\n        currentPositions: {},\n        currentItems: items,\n        previousItems: [],\n        config: {\n          addedItems: [],\n          removedItems: []\n        },\n        persistedElement: null\n      });\n      let newHash: string | null = getItemsHash(items);\n      let newGrid = newHash !== hash;\n      /* just to handle if clicking really fast, then ignore the update */\n      if (mount || commit) {\n        newGrid = false;\n        newHash = hash;\n      }\n\n      if (newGrid) {\n        refs.current.config = getConfig({\n          currentItems: refs.current.currentItems,\n          nextItems: items\n        });\n\n        /* START UPDATE */\n        if (!animate) {\n          refs.current.previousItems = refs.current.currentItems;\n        }\n        refs.current.currentItems = items;\n        /* END UPDATE */\n      }\n\n      const {\n        previousPositions,\n        currentPositions,\n        currentItems,\n        previousItems,\n        config: { addedItems, removedItems }\n      } = refs.current;\n\n      React.useEffect(() => {\n        if (newGrid) {\n          dispatch({\n            type: 'SET_HASH',\n            hash: newHash,\n            transition\n          });\n        }\n      }, [newHash, newGrid, transition]);\n\n      React.useEffect(() => {\n        if (mount) {\n          /* make sure the mount has been committed to the DOM, double make sure by wrapping in onNextFrame */\n          onNextFrame(() => {\n            dispatch({\n              type: 'COMMIT'\n            });\n          });\n        }\n      }, [mount]);\n\n      React.useEffect(() => {\n        if (commit) {\n          onNextFrame(() => {\n            dispatch({\n              type: 'ANIMATE'\n            });\n          });\n        }\n      }, [commit]);\n\n      React.useEffect(() => {\n        let timer: number;\n        const clear = () => {\n          window.clearTimeout(timer);\n        };\n        if (animate) {\n          timer = window.setTimeout(() => {\n            dispatch({\n              type: 'STOP_ANIMATION'\n            });\n          }, duration);\n        } else {\n          clear();\n        }\n        return clear;\n      }, [animate, newHash]);\n\n      if (commit) {\n        return refs.current.persistedElement;\n      }\n\n      const rows = ({\n        itemsToRender,\n        ref,\n        style\n      }: {\n        itemsToRender: Items;\n        ref?: (key: string, el: HTMLElement) => void;\n        style?: (key: string) => React.CSSProperties;\n      }) => {\n        const makeRef = (key: string) => {\n          if (typeof ref === 'undefined') {\n            return;\n          }\n          return (el: HTMLElement | null) => {\n            if (el) {\n              ref(key, el);\n            }\n          };\n        };\n\n        const makeStyle = (key: string) => {\n          return typeof style !== 'undefined' ? style(key) : undefined;\n        };\n\n        return renderCells(\n          itemsToRender.map(key => ({\n            key,\n            ref: makeRef(key),\n            style: makeStyle(key)\n          }))\n        );\n      };\n      const wrapperMeasureContainerHeight = (context: 'previous' | 'current') => (\n        el: HTMLElement | null\n      ) => {\n        if (!el) {\n          return;\n        }\n        refs.current.containerHeight[context] = el.offsetHeight;\n      };\n\n      const measureNewGrid = newGrid ? (\n        <AbsoluteWrapper ref={wrapperMeasureContainerHeight('current')}>\n          {rows({\n            itemsToRender: currentItems,\n            ref: (key, el) => {\n              currentPositions[key] = {\n                x: el.offsetLeft,\n                y: el.offsetTop\n              };\n            }\n          })}\n        </AbsoluteWrapper>\n      ) : null;\n\n      if (!transition) {\n        return (\n          <OuterBound ref={outerBoundRef}>\n            <Wrapper>\n              {rows({\n                itemsToRender: currentItems\n              })}\n            </Wrapper>\n          </OuterBound>\n        );\n      }\n\n      let child = (\n        <>\n          <Wrapper>\n            {rows({\n              itemsToRender: currentItems\n            })}\n          </Wrapper>\n          {measureNewGrid}\n        </>\n      );\n\n      if (newGrid) {\n        child = (\n          <>\n            <Wrapper ref={wrapperMeasureContainerHeight('previous')}>\n              {rows({\n                itemsToRender: previousItems,\n                ref: (key, el) => {\n                  if (el) {\n                    previousPositions[key] = {\n                      x: el.offsetLeft,\n                      y: el.offsetTop\n                    };\n                  }\n                }\n              })}\n            </Wrapper>\n            {measureNewGrid}\n          </>\n        );\n      }\n\n      const animationRenderItems = uniq([...previousItems, ...addedItems, ...removedItems]).sort();\n\n      if (mount) {\n        child = (\n          <>\n            <Wrapper style={{ height: refs.current.containerHeight.previous + 'px' }}>\n              {rows({\n                itemsToRender: animationRenderItems,\n                style(key) {\n                  const added = addedItems.includes(key);\n                  const removed = removedItems.includes(key);\n                  const { x, y } = added ? currentPositions[key] : previousPositions[key];\n\n                  let z = 1;\n\n                  if (added) {\n                    z = 0;\n                  }\n\n                  if (removed) {\n                    z = 1;\n                  }\n\n                  const transform = `translate3d(${[x, y, 0].join('px,')}px) scale(${z})`;\n\n                  const style: React.CSSProperties = {\n                    transform,\n                    position: 'absolute',\n                    top: 0,\n                    left: 0,\n                    margin: 0\n                  };\n\n                  return style;\n                }\n              })}\n            </Wrapper>\n          </>\n        );\n      }\n\n      if (animate) {\n        child = (\n          <>\n            <Wrapper style={{ height: refs.current.containerHeight.current + 'px' }}>\n              {rows({\n                itemsToRender: animationRenderItems,\n                style(key) {\n                  const added = addedItems.includes(key);\n                  const removed = removedItems.includes(key);\n                  /* currentPositions[key] can be undefined if new items are\n                 added during animate and are yet to be measured */\n                  const { x = 0, y = 0 } = currentPositions[key] || {};\n\n                  let z = 1;\n\n                  if (added) {\n                    z = 1;\n                  }\n\n                  if (removed) {\n                    z = 0;\n                  }\n\n                  const transform = `translate3d(${[x, y, 0].join('px,')}px) scale(${z})`;\n\n                  const style: React.CSSProperties = {\n                    transform,\n                    position: 'absolute',\n                    top: 0,\n                    left: 0,\n                    margin: 0,\n                    transition: `transform ${duration}ms ease`\n                  };\n                  return style;\n                }\n              })}\n            </Wrapper>\n            {measureNewGrid}\n          </>\n        );\n      }\n\n      refs.current.persistedElement = <OuterBound ref={outerBoundRef}>{child}</OuterBound>;\n\n      return refs.current.persistedElement;\n    }\n  )\n);\n\nexport default ReactMixitup;\n"]}]}