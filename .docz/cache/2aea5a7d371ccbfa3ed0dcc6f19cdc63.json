{"remainingRequest":"/Users/richie/projects/react-mixitup/node_modules/thread-loader/dist/cjs.js??ref--11-1!/Users/richie/projects/react-mixitup/node_modules/babel-loader/lib/index.js??ref--11-2!/Users/richie/projects/react-mixitup/node_modules/source-map-loader/index.js!/Users/richie/projects/react-mixitup/src/react-mixitup.tsx","dependencies":[{"path":"/Users/richie/projects/react-mixitup/src/react-mixitup.tsx","mtime":1555010315734},{"path":"/Users/richie/projects/react-mixitup/node_modules/cache-loader/dist/cjs.js","mtime":1555000957022},{"path":"/Users/richie/projects/react-mixitup/node_modules/thread-loader/dist/cjs.js","mtime":1555000957340},{"path":"/Users/richie/projects/react-mixitup/node_modules/babel-loader/lib/index.js","mtime":1548679235691},{"path":"/Users/richie/projects/react-mixitup/node_modules/source-map-loader/index.js","mtime":1548929420374}],"contextDependencies":[],"result":["import _toConsumableArray from\"/Users/richie/projects/react-mixitup/node_modules/docz-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/richie/projects/react-mixitup/node_modules/docz-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectSpread from\"/Users/richie/projects/react-mixitup/node_modules/docz-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";/**\n * @class ReactMixitup\n */import uniq from'lodash.uniq';import*as React from'react';var OuterBound=React.memo(React.forwardRef(function(props,ref){return React.createElement(\"div\",Object.assign({style:{position:'relative'}},props,{ref:ref}));}));function init(){return{animate:false,commit:false,firstRender:true,hash:null,mount:false};}var getItemsHash=function getItemsHash(items){return items.join(',');};function reducer(state,action){switch(action.type){case'SET_HASH':if(typeof action.hash==='undefined'){throw new Error();}var mount=true;if(state.firstRender||state.animate||state.mount||state.commit||!action.transition){mount=false;}return _objectSpread({},state,{hash:action.hash,firstRender:false,mount:mount});case'COMMIT':return _objectSpread({},state,{commit:true,mount:false});case'ANIMATE':return _objectSpread({},state,{animate:true,commit:false});case'STOP_ANIMATION':return _objectSpread({},state,{animate:false,mount:false});default:throw new Error();}}var getConfig=function getConfig(_ref){var currentItems=_ref.currentItems,nextItems=_ref.nextItems;var addedItems=nextItems.filter(function(currentKey){return!currentItems.includes(currentKey);});var removedItems=currentItems.filter(function(previousKey){return!nextItems.includes(previousKey);});return{addedItems:addedItems,removedItems:removedItems};};function onNextFrame(callback){setTimeout(function(){window.requestAnimationFrame(callback);},0);}var makeAbsoluteWrapper=function makeAbsoluteWrapper(Wrapper){return React.memo(React.forwardRef(function(props,ref){return React.createElement(Wrapper,Object.assign({style:{position:'absolute',top:'0',left:'0',right:'0',visibility:'hidden',zIndex:-1}},props,{ref:ref}));}));};var makeWrapper=function makeWrapper(ReactMixitupWrapper){return React.memo(React.forwardRef(function(props,ref){return React.createElement(ReactMixitupWrapper,Object.assign({},props,{ref:ref}));}));};var ReactMixitup=React.memo(React.forwardRef(function(_ref2,outerBoundRef){var unparsedItems=_ref2.items,_ref2$duration=_ref2.duration,duration=_ref2$duration===void 0?500:_ref2$duration,renderCells=_ref2.renderCells,_ref2$Wrapper=_ref2.Wrapper,ReactMixitupWrapper=_ref2$Wrapper===void 0?'div':_ref2$Wrapper,_ref2$transition=_ref2.transition,transition=_ref2$transition===void 0?true:_ref2$transition;var Wrapper=React.useMemo(function(){return makeWrapper(ReactMixitupWrapper);},[ReactMixitupWrapper]);var AbsoluteWrapper=React.useMemo(function(){return makeAbsoluteWrapper(Wrapper);},[Wrapper]);var items=unparsedItems.map(function(key){return key.toString();});var _React$useReducer=React.useReducer(reducer,items,init),_React$useReducer2=_slicedToArray(_React$useReducer,2),_React$useReducer2$=_React$useReducer2[0],hash=_React$useReducer2$.hash,animate=_React$useReducer2$.animate,mount=_React$useReducer2$.mount,commit=_React$useReducer2$.commit,unsafeDispatch=_React$useReducer2[1];var unmounted=React.useRef(false);React.useEffect(function(){return function(){unmounted.current=true;};},[]);var dispatch=React.useCallback(function(action){if(unmounted.current){return;}unsafeDispatch(action);},[]);var refs=React.useRef({containerHeight:{current:null,previous:null},previousPositions:{},currentPositions:{},currentItems:items,previousItems:[],config:{addedItems:[],removedItems:[]},persistedElement:null});var newHash=getItemsHash(items);var newGrid=newHash!==hash;/* just to handle if clicking really fast, then ignore the update */if(mount||commit){newGrid=false;newHash=hash;}if(newGrid){refs.current.config=getConfig({currentItems:refs.current.currentItems,nextItems:items});/* START UPDATE */if(!animate){refs.current.previousItems=refs.current.currentItems;}refs.current.currentItems=items;/* END UPDATE */}var _refs$current=refs.current,previousPositions=_refs$current.previousPositions,currentPositions=_refs$current.currentPositions,currentItems=_refs$current.currentItems,previousItems=_refs$current.previousItems,_refs$current$config=_refs$current.config,addedItems=_refs$current$config.addedItems,removedItems=_refs$current$config.removedItems;React.useEffect(function(){if(newGrid){dispatch({type:'SET_HASH',hash:newHash,transition:transition});}},[newHash,newGrid,transition]);React.useEffect(function(){if(mount){/* make sure the mount has been committed to the DOM, double make sure by wrapping in onNextFrame */onNextFrame(function(){dispatch({type:'COMMIT'});});}},[mount]);React.useEffect(function(){if(commit){onNextFrame(function(){dispatch({type:'ANIMATE'});});}},[commit]);React.useEffect(function(){var timer;var clear=function clear(){window.clearTimeout(timer);};if(animate){timer=window.setTimeout(function(){dispatch({type:'STOP_ANIMATION'});},duration);}else{clear();}return clear;},[animate,newHash]);if(commit){return refs.current.persistedElement;}var rows=function rows(_ref3){var itemsToRender=_ref3.itemsToRender,ref=_ref3.ref,style=_ref3.style;var makeRef=function makeRef(key){if(typeof ref==='undefined'){return;}return function(el){if(el){ref(key,el);}};};var makeStyle=function makeStyle(key){return typeof style!=='undefined'?style(key):undefined;};return renderCells(itemsToRender.map(function(key){return{key:key,ref:makeRef(key),style:makeStyle(key)};}));};var wrapperMeasureContainerHeight=function wrapperMeasureContainerHeight(context){return function(el){if(!el){return;}refs.current.containerHeight[context]=el.offsetHeight;};};var measureNewGrid=newGrid?React.createElement(AbsoluteWrapper,{ref:wrapperMeasureContainerHeight('current')},rows({itemsToRender:currentItems,ref:function ref(key,el){currentPositions[key]={x:el.offsetLeft,y:el.offsetTop};}})):null;if(!transition){return React.createElement(OuterBound,{ref:outerBoundRef},React.createElement(Wrapper,null,rows({itemsToRender:currentItems})));}var child=React.createElement(React.Fragment,null,React.createElement(Wrapper,null,rows({itemsToRender:currentItems})),measureNewGrid);if(newGrid){child=React.createElement(React.Fragment,null,React.createElement(Wrapper,{ref:wrapperMeasureContainerHeight('previous')},rows({itemsToRender:previousItems,ref:function ref(key,el){if(el){previousPositions[key]={x:el.offsetLeft,y:el.offsetTop};}}})),measureNewGrid);}var animationRenderItems=uniq([].concat(_toConsumableArray(previousItems),_toConsumableArray(addedItems),_toConsumableArray(removedItems))).sort();if(mount){child=React.createElement(React.Fragment,null,React.createElement(Wrapper,{style:{height:refs.current.containerHeight.previous+'px'}},rows({itemsToRender:animationRenderItems,style:function style(key){var added=addedItems.includes(key);var removed=removedItems.includes(key);var _ref4=added?currentPositions[key]:previousPositions[key],x=_ref4.x,y=_ref4.y;var z=1;if(added){z=0;}if(removed){z=1;}var transform=\"translate3d(\".concat([x,y,0].join('px,'),\"px) scale(\").concat(z,\")\");var style={transform:transform,position:'absolute',top:0,left:0,margin:0};return style;}})));}if(animate){child=React.createElement(React.Fragment,null,React.createElement(Wrapper,{style:{height:refs.current.containerHeight.current+'px'}},rows({itemsToRender:animationRenderItems,style:function style(key){var added=addedItems.includes(key);var removed=removedItems.includes(key);/* currentPositions[key] can be undefined if new items are\n                 added during animate and are yet to be measured */var _ref5=currentPositions[key]||{},_ref5$x=_ref5.x,x=_ref5$x===void 0?0:_ref5$x,_ref5$y=_ref5.y,y=_ref5$y===void 0?0:_ref5$y;var z=1;if(added){z=1;}if(removed){z=0;}var transform=\"translate3d(\".concat([x,y,0].join('px,'),\"px) scale(\").concat(z,\")\");var style={transform:transform,position:'absolute',top:0,left:0,margin:0,transition:\"transform \".concat(duration,\"ms ease\")};return style;}})),measureNewGrid);}refs.current.persistedElement=React.createElement(OuterBound,{ref:outerBoundRef},child);return refs.current.persistedElement;}));export default ReactMixitup;if(typeof ReactMixitup!=='undefined'&&ReactMixitup&&ReactMixitup===Object(ReactMixitup)){Object.defineProperty(ReactMixitup,'__filemeta',{enumerable:true,configurable:true,value:{name:\"ReactMixitup\",filename:\"src/react-mixitup.tsx\"}});}",{"version":3,"sources":["/Users/richie/projects/react-mixitup/src/react-mixitup.tsx"],"names":["uniq","React","OuterBound","memo","forwardRef","props","ref","position","init","animate","commit","firstRender","hash","mount","getItemsHash","items","join","reducer","state","action","type","Error","transition","getConfig","currentItems","nextItems","addedItems","filter","currentKey","includes","removedItems","previousKey","onNextFrame","callback","setTimeout","window","requestAnimationFrame","makeAbsoluteWrapper","Wrapper","top","left","right","visibility","zIndex","makeWrapper","ReactMixitupWrapper","ReactMixitup","outerBoundRef","unparsedItems","duration","renderCells","useMemo","AbsoluteWrapper","map","key","toString","useReducer","unsafeDispatch","unmounted","useRef","useEffect","current","dispatch","useCallback","refs","containerHeight","previous","previousPositions","currentPositions","previousItems","config","persistedElement","newHash","newGrid","timer","clear","clearTimeout","rows","itemsToRender","style","makeRef","el","makeStyle","undefined","wrapperMeasureContainerHeight","context","offsetHeight","measureNewGrid","x","offsetLeft","y","offsetTop","child","animationRenderItems","sort","height","added","removed","z","transform","margin"],"mappings":"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","sourcesContent":["/**\n * @class ReactMixitup\n */\n\nimport uniq from 'lodash.uniq';\nimport * as React from 'react';\n\ninterface IPosition {\n  x: number;\n  y: number;\n  z?: number;\n}\ninterface IPositions {\n  [key: string]: IPosition;\n}\ninterface IState {\n  hash: null | string;\n  mount: boolean;\n  commit: boolean;\n  animate: boolean;\n  firstRender: boolean;\n}\n\ntype UnparsedItems = Array<string | number | boolean>;\ntype Item = string;\ntype Items = Item[];\n\ninterface IWrapperProps {\n  children: React.ReactNode;\n  style?: React.CSSProperties;\n  ref?: React.Ref<any>;\n}\n\ntype WrapperType = any;\n\ninterface IProps {\n  items: UnparsedItems;\n  duration?: number;\n  renderCells: (\n    items: Array<{\n      key: string;\n      ref?: React.Ref<any>;\n      style?: React.CSSProperties;\n    }>\n  ) => React.ReactNode;\n  Wrapper?: WrapperType;\n  transition?: boolean;\n}\n\ninterface IAction {\n  type: 'SET_HASH' | 'STOP_ANIMATION' | 'ANIMATE' | 'COMMIT';\n  hash?: string | null;\n  key?: string;\n  el?: HTMLElement | null;\n  transition?: boolean;\n}\n\nconst OuterBound = React.memo(\n  React.forwardRef((props: { children: React.ReactNode }, ref?: React.Ref<any>) => (\n    <div style={{ position: 'relative' }} {...props} ref={ref} />\n  ))\n);\n\nfunction init(): IState {\n  return {\n    animate: false,\n    commit: false,\n    firstRender: true,\n    hash: null,\n    mount: false\n  };\n}\n\nconst getItemsHash = (items: Items): string => {\n  return items.join(',');\n};\n\nfunction reducer(state: IState, action: IAction): IState {\n  switch (action.type) {\n    case 'SET_HASH':\n      if (typeof action.hash === 'undefined') {\n        throw new Error();\n      }\n      let mount = true;\n      if (state.firstRender || state.animate || state.mount || state.commit || !action.transition) {\n        mount = false;\n      }\n      return {\n        ...state,\n        hash: action.hash,\n        firstRender: false,\n        mount\n      };\n    case 'COMMIT':\n      return {\n        ...state,\n        commit: true,\n        mount: false\n      };\n    case 'ANIMATE':\n      return {\n        ...state,\n        animate: true,\n        commit: false\n      };\n    case 'STOP_ANIMATION':\n      return {\n        ...state,\n        animate: false,\n        mount: false\n      };\n    default:\n      throw new Error();\n  }\n}\n\nconst getConfig = ({ currentItems, nextItems }: { currentItems: Items; nextItems: Items }) => {\n  const addedItems = nextItems.filter(currentKey => {\n    return !currentItems.includes(currentKey);\n  });\n  const removedItems = currentItems.filter(previousKey => {\n    return !nextItems.includes(previousKey);\n  });\n\n  return {\n    addedItems,\n    removedItems\n  };\n};\n\nfunction onNextFrame(callback: () => any) {\n  setTimeout(() => {\n    window.requestAnimationFrame(callback);\n  }, 0);\n}\n\nconst makeAbsoluteWrapper = (Wrapper: React.JSXElementConstructor<any>) =>\n  React.memo(\n    React.forwardRef((props: { children: React.ReactNode }, ref?: React.Ref<any>) => (\n      <Wrapper\n        style={{\n          position: 'absolute',\n          top: '0',\n          left: '0',\n          right: '0',\n          visibility: 'hidden',\n          zIndex: -1\n        }}\n        {...props}\n        ref={ref}\n      />\n    ))\n  );\n\nconst makeWrapper = (ReactMixitupWrapper: WrapperType) => {\n  return React.memo(\n    React.forwardRef((props: IWrapperProps, ref) => <ReactMixitupWrapper {...props} ref={ref} />)\n  );\n};\n\nconst ReactMixitup = React.memo(\n  React.forwardRef(\n    (\n      {\n        items: unparsedItems,\n        duration = 500,\n        renderCells,\n        Wrapper: ReactMixitupWrapper = 'div',\n        transition = true\n      }: IProps,\n      outerBoundRef: React.Ref<HTMLDivElement>\n    ): JSX.Element | null => {\n      const Wrapper = React.useMemo(() => makeWrapper(ReactMixitupWrapper), [ReactMixitupWrapper]);\n      const AbsoluteWrapper = React.useMemo(() => makeAbsoluteWrapper(Wrapper), [Wrapper]);\n\n      const items: Items = unparsedItems.map(key => key.toString());\n      const [{ hash, animate, mount, commit }, unsafeDispatch] = React.useReducer(\n        reducer,\n        items,\n        init\n      );\n\n      const unmounted = React.useRef(false);\n      React.useEffect(\n        () => () => {\n          unmounted.current = true;\n        },\n        []\n      );\n\n      const dispatch = React.useCallback((action: IAction) => {\n        if (unmounted.current) {\n          return;\n        }\n        unsafeDispatch(action);\n      }, []);\n\n      const refs = React.useRef<{\n        containerHeight: {\n          current: number | null;\n          previous: number | null;\n        };\n        previousPositions: IPositions;\n        currentPositions: IPositions;\n        currentItems: Items;\n        previousItems: Items;\n        config: {\n          addedItems: Items;\n          removedItems: Items;\n        };\n        persistedElement: JSX.Element | null;\n      }>({\n        containerHeight: { current: null, previous: null },\n        previousPositions: {},\n        currentPositions: {},\n        currentItems: items,\n        previousItems: [],\n        config: {\n          addedItems: [],\n          removedItems: []\n        },\n        persistedElement: null\n      });\n      let newHash: string | null = getItemsHash(items);\n      let newGrid = newHash !== hash;\n      /* just to handle if clicking really fast, then ignore the update */\n      if (mount || commit) {\n        newGrid = false;\n        newHash = hash;\n      }\n\n      if (newGrid) {\n        refs.current.config = getConfig({\n          currentItems: refs.current.currentItems,\n          nextItems: items\n        });\n\n        /* START UPDATE */\n        if (!animate) {\n          refs.current.previousItems = refs.current.currentItems;\n        }\n        refs.current.currentItems = items;\n        /* END UPDATE */\n      }\n\n      const {\n        previousPositions,\n        currentPositions,\n        currentItems,\n        previousItems,\n        config: { addedItems, removedItems }\n      } = refs.current;\n\n      React.useEffect(() => {\n        if (newGrid) {\n          dispatch({\n            type: 'SET_HASH',\n            hash: newHash,\n            transition\n          });\n        }\n      }, [newHash, newGrid, transition]);\n\n      React.useEffect(() => {\n        if (mount) {\n          /* make sure the mount has been committed to the DOM, double make sure by wrapping in onNextFrame */\n          onNextFrame(() => {\n            dispatch({\n              type: 'COMMIT'\n            });\n          });\n        }\n      }, [mount]);\n\n      React.useEffect(() => {\n        if (commit) {\n          onNextFrame(() => {\n            dispatch({\n              type: 'ANIMATE'\n            });\n          });\n        }\n      }, [commit]);\n\n      React.useEffect(() => {\n        let timer: number;\n        const clear = () => {\n          window.clearTimeout(timer);\n        };\n        if (animate) {\n          timer = window.setTimeout(() => {\n            dispatch({\n              type: 'STOP_ANIMATION'\n            });\n          }, duration);\n        } else {\n          clear();\n        }\n        return clear;\n      }, [animate, newHash]);\n\n      if (commit) {\n        return refs.current.persistedElement;\n      }\n\n      const rows = ({\n        itemsToRender,\n        ref,\n        style\n      }: {\n        itemsToRender: Items;\n        ref?: (key: string, el: HTMLElement) => void;\n        style?: (key: string) => React.CSSProperties;\n      }) => {\n        const makeRef = (key: string) => {\n          if (typeof ref === 'undefined') {\n            return;\n          }\n          return (el: HTMLElement | null) => {\n            if (el) {\n              ref(key, el);\n            }\n          };\n        };\n\n        const makeStyle = (key: string) => {\n          return typeof style !== 'undefined' ? style(key) : undefined;\n        };\n\n        return renderCells(\n          itemsToRender.map(key => ({\n            key,\n            ref: makeRef(key),\n            style: makeStyle(key)\n          }))\n        );\n      };\n      const wrapperMeasureContainerHeight = (context: 'previous' | 'current') => (\n        el: HTMLElement | null\n      ) => {\n        if (!el) {\n          return;\n        }\n        refs.current.containerHeight[context] = el.offsetHeight;\n      };\n\n      const measureNewGrid = newGrid ? (\n        <AbsoluteWrapper ref={wrapperMeasureContainerHeight('current')}>\n          {rows({\n            itemsToRender: currentItems,\n            ref: (key, el) => {\n              currentPositions[key] = {\n                x: el.offsetLeft,\n                y: el.offsetTop\n              };\n            }\n          })}\n        </AbsoluteWrapper>\n      ) : null;\n\n      if (!transition) {\n        return (\n          <OuterBound ref={outerBoundRef}>\n            <Wrapper>\n              {rows({\n                itemsToRender: currentItems\n              })}\n            </Wrapper>\n          </OuterBound>\n        );\n      }\n\n      let child = (\n        <>\n          <Wrapper>\n            {rows({\n              itemsToRender: currentItems\n            })}\n          </Wrapper>\n          {measureNewGrid}\n        </>\n      );\n\n      if (newGrid) {\n        child = (\n          <>\n            <Wrapper ref={wrapperMeasureContainerHeight('previous')}>\n              {rows({\n                itemsToRender: previousItems,\n                ref: (key, el) => {\n                  if (el) {\n                    previousPositions[key] = {\n                      x: el.offsetLeft,\n                      y: el.offsetTop\n                    };\n                  }\n                }\n              })}\n            </Wrapper>\n            {measureNewGrid}\n          </>\n        );\n      }\n\n      const animationRenderItems = uniq([...previousItems, ...addedItems, ...removedItems]).sort();\n\n      if (mount) {\n        child = (\n          <>\n            <Wrapper style={{ height: refs.current.containerHeight.previous + 'px' }}>\n              {rows({\n                itemsToRender: animationRenderItems,\n                style(key) {\n                  const added = addedItems.includes(key);\n                  const removed = removedItems.includes(key);\n                  const { x, y } = added ? currentPositions[key] : previousPositions[key];\n\n                  let z = 1;\n\n                  if (added) {\n                    z = 0;\n                  }\n\n                  if (removed) {\n                    z = 1;\n                  }\n\n                  const transform = `translate3d(${[x, y, 0].join('px,')}px) scale(${z})`;\n\n                  const style: React.CSSProperties = {\n                    transform,\n                    position: 'absolute',\n                    top: 0,\n                    left: 0,\n                    margin: 0\n                  };\n\n                  return style;\n                }\n              })}\n            </Wrapper>\n          </>\n        );\n      }\n\n      if (animate) {\n        child = (\n          <>\n            <Wrapper style={{ height: refs.current.containerHeight.current + 'px' }}>\n              {rows({\n                itemsToRender: animationRenderItems,\n                style(key) {\n                  const added = addedItems.includes(key);\n                  const removed = removedItems.includes(key);\n                  /* currentPositions[key] can be undefined if new items are\n                 added during animate and are yet to be measured */\n                  const { x = 0, y = 0 } = currentPositions[key] || {};\n\n                  let z = 1;\n\n                  if (added) {\n                    z = 1;\n                  }\n\n                  if (removed) {\n                    z = 0;\n                  }\n\n                  const transform = `translate3d(${[x, y, 0].join('px,')}px) scale(${z})`;\n\n                  const style: React.CSSProperties = {\n                    transform,\n                    position: 'absolute',\n                    top: 0,\n                    left: 0,\n                    margin: 0,\n                    transition: `transform ${duration}ms ease`\n                  };\n                  return style;\n                }\n              })}\n            </Wrapper>\n            {measureNewGrid}\n          </>\n        );\n      }\n\n      refs.current.persistedElement = <OuterBound ref={outerBoundRef}>{child}</OuterBound>;\n\n      return refs.current.persistedElement;\n    }\n  )\n);\n\nexport default ReactMixitup;\n"]}]}